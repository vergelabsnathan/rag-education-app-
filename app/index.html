<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onderwijs Assistent</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Marked.js for markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Docx.js for Word export -->
    <script src="https://cdn.jsdelivr.net/npm/docx@8.2.0/build/index.umd.min.js"></script>
    <!-- FileSaver.js for saving files -->
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Onderwijs Assistent</span>
                </div>
                <button class="new-chat-btn" onclick="startNewChat()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"/>
                    </svg>
                    Nieuw gesprek
                </button>
            </div>

            <div class="sidebar-section">
                <div class="section-title">Recente gesprekken</div>
                <div class="conversation-list" id="conversationList">
                    <!-- Conversations will be loaded here -->
                </div>
            </div>

            <div class="sidebar-footer">
                <div class="user-info" id="userInfo">
                    <div class="user-avatar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </div>
                    <div class="user-details">
                        <span class="user-name">Gast</span>
                        <span class="user-tier">Gratis abonnement</span>
                    </div>
                </div>
                <button class="logout-btn" onclick="handleLogout()" title="Uitloggen">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                </button>
                <button class="settings-btn" onclick="openSettings()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Chat Area -->
            <div class="chat-container" id="chatContainer">
                <!-- Welcome Screen (shown when no conversation) -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <h1>Onderwijs Assistent</h1>
                    <p>Jouw AI-partner voor het implementeren van onderwijsinnovaties, lesplannen en trainingsworkshops.</p>

                    <div class="quick-actions">
                        <button class="quick-action" onclick="sendQuickMessage('Maak een lesplan voor HAVO 4 aardrijkskunde over klimaatverandering met formatieve toetsing')">
                            <div class="quick-action-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                    <polyline points="10 9 9 9 8 9"/>
                                </svg>
                            </div>
                            <div class="quick-action-text">
                                <span class="quick-action-title">Lesplan</span>
                                <span class="quick-action-desc">Innovatieve lesplannen maken</span>
                            </div>
                        </button>

                        <button class="quick-action" onclick="sendQuickMessage('Ontwerp een trainingsworkshop over formatief toetsen voor docenten')">
                            <div class="quick-action-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                    <circle cx="9" cy="7" r="4"/>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                </svg>
                            </div>
                            <div class="quick-action-text">
                                <span class="quick-action-title">Training Workshop</span>
                                <span class="quick-action-desc">Ontwerp professionalisering</span>
                            </div>
                        </button>

                        <button class="quick-action" onclick="sendQuickMessage('Maak een implementatieplan voor het invoeren van portfolio-assessment op onze school')">
                            <div class="quick-action-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="12 2 2 7 12 12 22 7 12 2"/>
                                    <polyline points="2 17 12 22 22 17"/>
                                    <polyline points="2 12 12 17 22 12"/>
                                </svg>
                            </div>
                            <div class="quick-action-text">
                                <span class="quick-action-title">Implementatieplan</span>
                                <span class="quick-action-desc">Plan onderwijsvernieuwing</span>
                            </div>
                        </button>

                        <button class="quick-action" onclick="sendQuickMessage('Wat zijn effectieve strategieen voor differentiatie in het voortgezet onderwijs?')">
                            <div class="quick-action-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"/>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                </svg>
                            </div>
                            <div class="quick-action-text">
                                <span class="quick-action-title">Kennisbank</span>
                                <span class="quick-action-desc">Zoek in de kennisbank</span>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Messages Container -->
                <div class="messages-container" id="messagesContainer">
                    <!-- Messages will be rendered here -->
                </div>

                <!-- Typing Indicator -->
                <div class="typing-indicator" id="typingIndicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <span>Aan het nadenken...</span>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-container">
                <!-- File attachments container (above input) -->
                <div class="attachments-container" id="attachmentsContainer">
                    <!-- File chips will be dynamically inserted here -->
                </div>

                <div class="input-wrapper">
                    <!-- Attachment button -->
                    <button class="attachment-btn" id="attachmentBtn" onclick="openFilePicker()" title="Bijlage toevoegen (PDF, TXT)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"/>
                        </svg>
                    </button>

                    <textarea
                        id="messageInput"
                        placeholder="Stel een vraag aan de Onderwijs Assistent..."
                        rows="1"
                        onkeydown="handleKeyDown(event)"
                        oninput="autoResize(this)"
                    ></textarea>
                    <button class="send-btn" id="sendBtn" onclick="sendMessage()" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"/>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                        </svg>
                    </button>
                </div>

                <!-- Hidden file input -->
                <input type="file" id="fileInput" multiple accept=".pdf,.txt,.docx,application/pdf,text/plain,application/vnd.openxmlformats-officedocument.wordprocessingml.document" style="display: none;" onchange="handleFileSelect(event)">

                <div class="input-footer">
                    <span class="usage-info" id="usageInfo">5 documenten resterend deze maand</span>
                </div>
            </div>

            <!-- Drop zone overlay (for drag & drop) -->
            <div class="drop-zone-overlay" id="dropZoneOverlay">
                <div class="drop-zone-content">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    <span>Sleep bestanden hier naartoe</span>
                </div>
            </div>
        </main>

        <!-- Artifact Panel (slides in from right) -->
        <aside class="artifact-panel" id="artifactPanel">
            <div class="artifact-header">
                <h3 id="artifactTitle">Document</h3>
                <div class="artifact-actions">
                    <button class="artifact-btn" onclick="copyArtifact()" title="Kopieer">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                        </svg>
                    </button>
                    <button class="artifact-btn" onclick="downloadAsWord()" title="Download als Word">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <path d="M9 13h2l1 4 1-4h2"/>
                        </svg>
                    </button>
                    <button class="artifact-btn" onclick="openInGoogleDocs()" title="Openen in Google Docs">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                    </button>
                    <button class="artifact-btn" onclick="closeArtifactPanel()" title="Sluiten">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="artifact-content" id="artifactContent">
                <!-- Artifact content will be rendered here -->
            </div>
        </aside>

        <!-- Feedback Panel (collapsible drawer on right) -->
        <aside class="feedback-panel" id="feedbackPanel">
            <div class="feedback-header">
                <h3>Feedback</h3>
                <button class="feedback-close-btn" onclick="closeFeedbackPanel()" title="Sluiten">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="feedback-content">
                <div class="feedback-form">
                    <label for="feedbackInput">Deel je feedback over dit gesprek:</label>
                    <textarea id="feedbackInput" placeholder="Schrijf hier je feedback, suggesties of problemen..." rows="4"></textarea>
                    <button class="feedback-submit-btn" onclick="submitFeedback()" id="feedbackSubmitBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"/>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                        </svg>
                        Verstuur feedback
                    </button>
                </div>
                <div class="feedback-list-section">
                    <h4>Eerdere feedback in dit gesprek</h4>
                    <div class="feedback-list" id="feedbackList">
                        <!-- Feedback items will be rendered here -->
                        <div class="feedback-empty">Nog geen feedback voor dit gesprek</div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Feedback Button (floating) -->
    <button class="feedback-fab" id="feedbackFab" onclick="toggleFeedbackPanel()" title="Feedback geven">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            <line x1="9" y1="10" x2="15" y2="10"/>
            <line x1="12" y1="7" x2="12" y2="13"/>
        </svg>
    </button>

    <!-- Mobile sidebar toggle -->
    <button class="mobile-menu-btn" id="mobileMenuBtn" onclick="toggleSidebar()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="12" x2="21" y2="12"/>
            <line x1="3" y1="6" x2="21" y2="6"/>
            <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
    </button>

    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-modal-backdrop"></div>
        <div class="login-modal-content">
            <div class="login-header">
                <div class="login-logo">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h2>Onderwijs Assistent</h2>
                <p>Log in om de Onderwijs Assistent te gebruiken</p>
            </div>
            <form class="login-form" onsubmit="handleLogin(event); return false;">
                <div class="login-error" id="loginError" style="display: none;"></div>
                <div class="form-group">
                    <label for="loginUsername">Gebruikersnaam</label>
                    <input
                        type="text"
                        id="loginUsername"
                        name="username"
                        placeholder="Voer je gebruikersnaam in"
                        autocomplete="username"
                        required
                    >
                </div>
                <div class="form-group">
                    <label for="loginPassword">Wachtwoord</label>
                    <input
                        type="password"
                        id="loginPassword"
                        name="password"
                        placeholder="Voer je wachtwoord in"
                        autocomplete="current-password"
                        onkeydown="handleLoginKeyDown(event)"
                        required
                    >
                </div>
                <button type="submit" class="login-submit" id="loginSubmit">Inloggen</button>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
